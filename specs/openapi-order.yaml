openapi: 3.0.3
info:
  title: Order Service API
  version: 1.0.0
paths:
  /orders:
    post:
      summary: Crea un nuevo pedido
      operationId: createOrder
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrderRequest'
      responses:
        '201':
          description: Pedido creado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateOrderResponse'
  /orders/{id}:
    get:
      summary: Obtiene un pedido por identificador
      operationId: getOrder
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Pedido encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetOrderResponse'
  /orders/{id}/cancel:
    post:
      summary: Cancela un pedido existente
      operationId: cancelOrder
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '202':
          description: Cancelación aceptada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CancelOrderResponse'
components:
  schemas:
    Order:
      type: object
      description: Representa un pedido gestionado por el servicio de órdenes.
      properties:
        orderId:
          type: string
          example: ORD-123456
        lines:
          type: array
          items:
            $ref: '#/components/schemas/OrderLine'
        amount:
          type: number
          format: double
          example: 149.99
        status:
          type: string
          enum:
            - PLACED
            - CANCELLED
            - CONFIRMED
            - FAILED
          example: PLACED
      required:
        - orderId
        - lines
        - amount
        - status
      additionalProperties: false
    OrderLine:
      type: object
      description: Línea de pedido con SKU y cantidad solicitada.
      properties:
        sku:
          type: string
          example: SKU-001
        qty:
          type: integer
          minimum: 1
          example: 2
      required:
        - sku
        - qty
      additionalProperties: false
    CreateOrderRequest:
      type: object
      description: Solicitud para crear un nuevo pedido.
      properties:
        requestId:
          type: string
          example: REQ-abc-123
        lines:
          type: array
          minItems: 1
          items:
            $ref: '#/components/schemas/OrderLine'
        amount:
          type: number
          format: double
          example: 149.99
      required:
        - requestId
        - lines
        - amount
      additionalProperties: false
    CreateOrderResponse:
      type: object
      description: Respuesta al crear un pedido.
      properties:
        orderId:
          type: string
          example: ORD-123456
        status:
          type: string
          enum:
            - PLACED
            - CANCELLED
            - CONFIRMED
            - FAILED
          example: PLACED
      required:
        - orderId
        - status
      additionalProperties: false
    CancelOrderResponse:
      type: object
      description: Respuesta tras solicitar la cancelación de un pedido.
      properties:
        orderId:
          type: string
          example: ORD-123456
        status:
          type: string
          enum:
            - PLACED
            - CANCELLED
            - CONFIRMED
            - FAILED
          example: CANCELLED
      required:
        - orderId
        - status
      additionalProperties: false
    GetOrderResponse:
      allOf:
        - $ref: '#/components/schemas/Order'
