{
  "name": "Retailer Happy Path Saga",
  "version": 1,
  "domains": [
    { "id": "order", "queue": "orders" },
    { "id": "inventory", "queue": "inventory" },
    { "id": "payments", "queue": "payments" },
    { "id": "shipping", "queue": "shipping" }
  ],
  "events": [
    {
      "name": "OrderPlaced",
      "payloadSchema": {
        "orderId": "string",
        "lines": [
          {
            "sku": "string",
            "qty": "number"
          }
        ],
        "amount": "number",
        "address": {
          "line1": "string",
          "city": "string",
          "zip": "string",
          "country": "string"
        }
      }
    },
    {
      "name": "InventoryReserved",
      "payloadSchema": {
        "reservationId": "string",
        "orderId": "string",
        "items": [
          {
            "sku": "string",
            "qty": "number"
          }
        ],
        "amount": "number",
        "address": {
          "line1": "string",
          "city": "string",
          "zip": "string",
          "country": "string"
        }
      }
    },
    {
      "name": "PaymentAuthorized",
      "payloadSchema": {
        "paymentId": "string",
        "orderId": "string",
        "reservationId": "string",
        "amount": "number",
        "address": {
          "line1": "string",
          "city": "string",
          "zip": "string",
          "country": "string"
        }
      }
    },
    {
      "name": "ShipmentPrepared",
      "payloadSchema": {
        "shipmentId": "string",
        "orderId": "string",
        "address": {
          "line1": "string",
          "city": "string",
          "zip": "string",
          "country": "string"
        }
      }
    },
    {
      "name": "PaymentCaptured",
      "payloadSchema": {
        "paymentId": "string",
        "orderId": "string",
        "amount": "number"
      }
    },
    {
      "name": "OrderConfirmed",
      "payloadSchema": {
        "orderId": "string",
        "status": "string"
      }
    }
  ],
  "listeners": [
    {
      "id": "order-on-OrderPlaced",
      "delayMs": 20,
      "on": {
        "event": "OrderPlaced"
      },
      "actions": [
        {
          "type": "set-state",
          "domain": "order",
          "status": "PLACED"
        },
        {
          "type": "emit",
          "event": "InventoryReserved",
          "toDomain": "inventory"
        }
      ]
    },
    {
      "id": "inventory-on-InventoryReserved",
      "delayMs": 30,
      "on": {
        "event": "InventoryReserved"
      },
      "actions": [
        {
          "type": "set-state",
          "domain": "inventory",
          "status": "RESERVED"
        },
        {
          "type": "emit",
          "event": "PaymentAuthorized",
          "toDomain": "payments"
        }
      ]
    },
    {
      "id": "payments-on-PaymentAuthorized",
      "delayMs": 40,
      "on": {
        "event": "PaymentAuthorized"
      },
      "actions": [
        {
          "type": "set-state",
          "domain": "payments",
          "status": "AUTHORIZED"
        },
        {
          "type": "emit",
          "event": "ShipmentPrepared",
          "toDomain": "shipping"
        }
      ]
    },
    {
      "id": "shipping-on-ShipmentPrepared",
      "delayMs": 50,
      "on": {
        "event": "ShipmentPrepared"
      },
      "actions": [
        {
          "type": "set-state",
          "domain": "shipping",
          "status": "PREPARED"
        },
        {
          "type": "emit",
          "event": "PaymentCaptured",
          "toDomain": "order"
        }
      ]
    },
    {
      "id": "order-on-PaymentCaptured",
      "delayMs": 25,
      "on": {
        "event": "PaymentCaptured"
      },
      "actions": [
        {
          "type": "set-state",
          "domain": "order",
          "status": "CONFIRMED"
        },
        {
          "type": "emit",
          "event": "OrderConfirmed",
          "toDomain": "order"
        }
      ]
    }
  ]
}
